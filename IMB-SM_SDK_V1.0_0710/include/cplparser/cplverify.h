/*************************************************  Copyright (C), 2010-2099, dadimedia.com  File name: cplverify.cpp  Author: zhangliang   Version:1.0    Date:2010/02/15  Description: CPLVERIFY  Others:           Function List:      1. CPL format verify；    2. CPL signature verify；  History:              <author>		<time>    <version >   <desc>      zhangliang  10/02/15     1.0       build this moudle        yinlifang   10/09/21     1.0       check this moudle  *************************************************/#ifndef _CPLVERIFY_H#define _CPLVERIFY_H#include "xml/XmlDocument.h"#include <map>#include <vector>XERCES_CPP_NAMESPACE_USEusing namespace xercesc; using namespace std;class cplVerify{public:	//内部类，主要保存CPL的xml节点对象	class CPLNode	{	public:		CPLNode();		CXmlResultSet* pxmlSignature;		CXmlResultSet* pxmlX509Certificate;		CXmlResultSet* pxmlPicture;		CXmlResultSet* pxmlPicAssetID;		CXmlResultSet* pxmlPicKeyID;		CXmlResultSet* pxmlSound;		CXmlResultSet* pxmlSouAssetID;		CXmlResultSet* pxmlSouKeyID;		CXmlResultSet* pxmlSubtitle;		CXmlResultSet* pxmlSubAssetID;		CXmlResultSet* pxmlSubKeyID;		CXmlResultSet* pxmlID;//add by zhangliang 2010.8.5					//-------------------------------		//add by huweihua 2011/7/16		CXmlResultSet* pxmlPicDuration;		CXmlResultSet* pxmlPicEidtRate;		CXmlResultSet* pxmlSouDurantion;		CXmlResultSet* pxmlSouEidtRate;			//-------------------------------		};	cplVerify(void);	~cplVerify(void);	/****FUNCTION***************************************************	* DESCRIPTION : CPL验证初始化,解析xml节点	*       INPUT : puchFilePath CPL文件名（包含路径）	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_VerifyInitial(const unsigned char* puchFilePath); //by yin 2010.9.21 建议改为私有函数	/****FUNCTION***************************************************	* DESCRIPTION : CPL验证初始化,解析xml节点	*       INPUT : strCPL CPL内容字符流	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_VerifyInitial(const char* strCPL);//by yin 2010.9.21 建议改为私有函数		/****FUNCTION***************************************************	* DESCRIPTION :CPL签名验证	*       INPUT : strCPL CPL内容字符流	*             : cert  签名证书	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_SignatureVerify(const char* strCPL,const char* cert);	//by yin 2010.9.21 建议改为私有函数			/****FUNCTION***************************************************	* DESCRIPTION :CPL签名验证	*       INPUT : puchFilePath CPL文件名（包含路径）	*             : cert  签名证书	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_SignatureVerify(const unsigned char* puchFilePath,const char* cert);//by yin 2010.9.21 建议改为私有函数	/****FUNCTION***************************************************	* DESCRIPTION :CPL证书格式验证	*       INPUT : 无	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_CertFormatCheck();//by yin 2010.9.21 建议改为私有函数	/****FUNCTION***************************************************	* DESCRIPTION :CPL格式验证	*       INPUT : 无	*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int CPL_FormatCheck();//by yin 2010.9.21 建议改为私有函数	/****FUNCTION***************************************************	* DESCRIPTION :CPL验证	*       INPUT : puchFilePath CPL文件名（包含路径）		*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int VerifyFile(const unsigned char* puchFilePath);		/****FUNCTION***************************************************	* DESCRIPTION :CPL验证	*       INPUT : strCPL CPL内容字符流		*      OUTPUT : 无	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int VerifyString(const char* strCPL);	/****FUNCTION***************************************************	* DESCRIPTION : 获取CPL签名证书链的证书指纹个数	*       INPUT : 无	*      OUTPUT : iNum 证书指纹个数	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetCertThumbprintNum(int* iNum);			/****FUNCTION***************************************************	* DESCRIPTION : 获取CPL签名证书链的证书指纹	*       INPUT : 无	*      OUTPUT : vecThumbprint 证书指纹	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetCertThumbprint(vector<char*> vecThumbprint); //???作为输出参数应为vector<char*>& add by yin 2010.9.20		/****FUNCTION***************************************************	* DESCRIPTION : 获取CPL的签名者证书指纹，用于cpl日志	*       INPUT : 无	*      OUTPUT : puchSignerThumbprint 签名者证书指纹//add by yin 2010.9.20 puchSignerThumbprint的大小需指定	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetSignerThumbprint(unsigned char* puchSignerThumbprint);		/****FUNCTION***************************************************	* DESCRIPTION : 获取CPL的ID	*       INPUT : 无	*      OUTPUT : puchCPLId 签名者证书指纹//add by yin 2010.9.20 puchCPLId的大小需指定	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetCPLId(unsigned char* puchCPLId);		/****FUNCTION***************************************************	* DESCRIPTION : 获取轨迹文件Id和keyId对应表	*       INPUT : 无	*      OUTPUT : mapId2KeyId 轨迹文件Id和keyId对应的map表	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetId2KeyIdMap(map<string,string> &mapId2KeyId);	//by yin 2010.9.21 建议改为输出参数为3个map（音频、视频、字幕），以备密钥类型检查之用		/****FUNCTION***************************************************	* DESCRIPTION : 获取cpl对应播放内容是否加密的标志	*       INPUT : 无	*      OUTPUT : blEncFlag 是否加密的标志	*     RETURNS : 0成功 非0失败	*    CAUTIONS : 无	****************************************************************/	int GetEncFlag(bool &blEncFlag);			//--------------------------	//add by huweihua 11/07/16	unsigned int GetCPLDuration();	//--------------------------private:	CXmlDocument* m_xmlDocument;//用于解析CPL的xml对象	CPLNode* m_pCPLNode;	vector<char*> m_vecThumbprint;  //by yin 2010.9.20 在实现中没有用到，建议删除};#endif